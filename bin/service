#!/bin/bash

DIR="$(dirname "$0")"
. "${DIR}/config"

gcloud beta run deploy $SERVICE_NAME \
	--image "gcr.io/${PROJECT}/${SERVICE_NAME}:${SERVICE_VERSION}" \
    --service-account "${SERVICE_NAME}-sa@${PROJECT}.iam.gserviceaccount.com" \
	--allow-unauthenticated \
    --platform managed \
	--region $SERVICE_REGION \
	--set-env-vars "RELEASE=v${SERVICE_VERSION},DB_ID=projects/${PROJECT}/instances/${SERVICE_NAME}/databases/${SERVICE_NAME}-db,OAUTH_CLIENT_ID=${LI_OAUTH_CLIENT_ID},OAUTH_CLIENT_SECRET=${LI_OAUTH_CLIENT_SECRET}"
